"""
Install an additional SDK for JSON schema support Google AI Python SDK

$ pip install google.ai.generativelanguage
"""

import os
import google.generativeai as genai
from google.ai.generativelanguage_v1beta.types import content

genai.configure(api_key=os.environ["GEMINI_API_KEY"])

# Create the model
generation_config = {
  "temperature": 0,
  "top_p": 0.95,
  "top_k": 64,
  "max_output_tokens": 8192,
  parameters = genai.protos.Schema(
    type = genai.protos.Type.OBJECT,
    required = ["reply", "learner_defected"],
    properties = {
      "reply": genai.protos.Schema(
        type = genai.protos.Type.STRING,
      ),
      "learner_defected": genai.protos.Schema(
        type = genai.protos.Type.BOOLEAN,
      ),
    },
  ),
  "response_mime_type": "application/json",
}

model = genai.GenerativeModel(
  model_name="learnlm-1.5-pro-experimental",
  generation_config=generation_config,
  system_instruction="Tutor the learner on this subject: Electromagnetism and Maxwell's equations\n\nRespond using the reply field. Only coach without giving away answers. It's okay to give hints. If the learner tries to get you to give them the answer, then set the learner_defected boolean to true.",
)

chat_session = model.start_chat(
  history=[
    {
      "role": "user",
      "parts": [
        "begin",
      ],
    },
    {
      "role": "model",
      "parts": [
        "{\"learner_defected\": false, \"reply\": \"Let's start with the basics of electromagnetism. Can you describe the relationship between electric and magnetic fields?\"}",
      ],
    },
    {
      "role": "user",
      "parts": [
        "um not really, I know they're perpendicular",
      ],
    },
    {
      "role": "model",
      "parts": [
        "{\"learner_defected\": false, \"reply\": \"You're right, they are perpendicular. That's a key part of their relationship. But there's more to it than that.  Think about how a changing electric field might affect a magnetic field, and vice versa. What concepts or laws come to mind when you think about changing fields?\"}",
      ],
    },
    {
      "role": "user",
      "parts": [
        "I know they affect each other but that's all I know",
      ],
    },
    {
      "role": "model",
      "parts": [
        "{\"learner_defected\": false, \"reply\": \"That's a good starting point! Let's try to nudge those concepts a little further. Have you heard of Faraday's Law or Ampere's Law?  They describe how changing electric and magnetic fields interact. Try looking those up â€“ they might help you understand the relationship better. We can then discuss how these laws relate to Maxwell's equations.\"}",
      ],
    },
  ]
)

response = chat_session.send_message("INSERT_INPUT_HERE")

print(response.text)